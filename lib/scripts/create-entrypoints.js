#!/usr/bin/env node

/**
 * External dependencies
 */
import fs from 'fs';
import path from 'path';

const currentPath = process.cwd();
let entry = {};

// create the entry directory
fs.mkdirSync('lib/entry', {recursive: true});

let heading = `/**
 *  Autogenerated Entrypoint  
 *  DO NOT MODIFY
 */\n`;

// iterate over all colorschemes
fs.readdirSync(path.join(currentPath, 'src', 'styles', 'colorschemes')).forEach((c) => {
    let scheme = c.substring(0, c.indexOf('.')).replace(' ', '');

    // add entries for each colorscheme 
    entry[scheme] = [
        path.join(currentPath, 'src', 'styles', 'colorschemes', c),
        path.join(currentPath, 'src', 'scripts', 'index.js')
      ];

    // correct file paths for output
    // since the entrypoint only generates one colorscheme
    // we don't want to clean the output path folder
    // case there are other colorschemes built there.
    let output = `
export default {
    entry: {
        ${scheme}: [
            ${ entry[scheme]
                .map(f => `'${f.replaceAll('\\', '/')}'`)
                .join(',\n' + `\t`.repeat(3) ) }
        ]
    },
    output: {
        clean: false
    }
};
    `;

    // write and entrypoint 
    // this allows for serving of a specific entry.
    fs.writeFileSync(
        `./lib/entry/${scheme}.js`,
        `${heading} ${output}`
    )

})

export default {entry};